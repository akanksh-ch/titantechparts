{
  "$jsonSchema": {
    "bsonType": "object",
    "required": ["userId", "items", "amount", "currency", "createdAt"],
    "additionalProperties": false,
    "properties": {
      "_id": {
        "bsonType": "objectId",
        "description": "Order identifier"
      },
      "userId": {
        "bsonType": "objectId",
        "description": "Reference to users._id"
      },
      "items": {
        "bsonType": "array",
        "minItems": 1,
        "description": "Line items in the order",
        "items": {
          "bsonType": "object",
          "required": ["inventoryId", "quantity"],
          "additionalProperties": false,
          "properties": {
            "inventoryId": {
              "bsonType": "objectId",
              "description": "Reference to inventory._id"
            },
            "quantity": {
              "bsonType": "int",
              "minimum": 1,
              "description": "Quantity of this inventory item"
            },
            "unitPrice": {
              "bsonType": "double",
              "minimum": 0,
              "description": "Price per unit at time of sale"
            },
            "lineTotal": {
              "bsonType": "double",
              "minimum": 0,
              "description": "Total for this line (quantity * unitPrice)"
            }
          }
        }
      },
      "amount": {
        "bsonType": "double",
        "minimum": 0,
        "description": "Total order amount"
      },
      "currency": {
        "bsonType": "string",
        "enum": ["GBP", "USD", "EUR"],
        "description": "ISO-like currency code"
      },
      "status": {
        "bsonType": "string",
        "enum": ["pending", "paid", "refunded", "cancelled"],
        "description": "Order status"
      },
      "createdAt": {
        "bsonType": "date",
        "description": "Creation timestamp"
      },
      "updatedAt": {
        "bsonType": "date",
        "description": "Last update timestamp"
      }
    }
  }
}
